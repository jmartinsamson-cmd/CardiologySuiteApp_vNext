<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Parse Debug Test</title>
    <style>
      body {
        font-family: monospace;
        padding: 20px;
      }
      textarea {
        width: 100%;
        height: 150px;
        margin: 10px 0;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
      }
      #output {
        white-space: pre-wrap;
        background: #f5f5f5;
        padding: 10px;
        margin-top: 10px;
      }
      .error {
        color: red;
      }
      .success {
        color: green;
      }
    </style>
  </head>
  <body>
    <h1>Parse Button Debug Test</h1>

    <div id="status"></div>

    <h2>Test Input:</h2>
    <textarea id="vs-paste" placeholder="Paste clinical note here...">
Patient is a 65 yo male with CP.

Vitals: BP 140/90, HR 88, RR 16, Temp 98.6F, SpO2 98% RA

Labs: Na 138, K 4.2, Cr 1.1, Trop 0.5

EKG: NSR, no acute changes

Assessment: Chest pain, likely ACS

Plan: Aspirin, heparin, cardiology consult
  </textarea
    >

    <button id="vs-parse">ðŸ”„ Test Parse Button</button>
    <button id="check-functions">Check Functions</button>

    <h2>Output:</h2>
    <div id="output"></div>

    <!-- Load all scripts in order -->
    <script src="src/core/app.js"></script>
    <script src="src/utils/parserHelpers_clean.js"></script>
    <script src="src/parsers/noteParser.js"></script>
    <script src="src/parsers/noteParser_full.js"></script>
    <script type="module" src="src/parsers/templateRenderer.js"></script>

    <script>
      // Debug script
      const status = document.getElementById("status");
      const output = document.getElementById("output");

      function log(msg, isError = false) {
        const div = document.createElement("div");
        div.textContent = msg;
        div.className = isError ? "error" : "success";
        status.appendChild(div);
        console.log(msg);
      }

      // Wait for everything to load
      setTimeout(() => {
        log("âœ… Page loaded");

        // Check if button exists
        const parseBtn = document.getElementById("vs-parse");
        log(
          parseBtn ? "âœ… Parse button found" : "âŒ Parse button NOT found",
          !parseBtn,
        );

        // Check if textarea exists
        const textarea = document.getElementById("vs-paste");
        log(
          textarea ? "âœ… Textarea found" : "âŒ Textarea NOT found",
          !textarea,
        );

        // Check if parser functions exist
        log(
          window.parseClinicalNoteFull
            ? "âœ… parseClinicalNoteFull exists"
            : "âŒ parseClinicalNoteFull missing",
          !window.parseClinicalNoteFull,
        );
        log(
          window.parseClinicalNote
            ? "âœ… parseClinicalNote exists"
            : "âŒ parseClinicalNote missing",
          !window.parseClinicalNote,
        );
        log(
          window.parseNoteIntoSections
            ? "âœ… parseNoteIntoSections exists"
            : "âŒ parseNoteIntoSections missing",
          !window.parseNoteIntoSections,
        );

        // Check if templateRenderer exists
        log(
          window.templateRenderer
            ? "âœ… templateRenderer exists"
            : "âŒ templateRenderer missing",
          !window.templateRenderer,
        );

        // Manual test button
        document
          .getElementById("check-functions")
          .addEventListener("click", () => {
            output.textContent = "";
            const text = textarea.value;

            output.textContent += "Testing parseClinicalNoteFull...\n";
            if (window.parseClinicalNoteFull) {
              try {
                const result = window.parseClinicalNoteFull(text);
                output.textContent +=
                  "Result: " + JSON.stringify(result, null, 2) + "\n\n";
              } catch (err) {
                output.textContent += "Error: " + err.message + "\n\n";
              }
            }

            output.textContent += "Testing templateRenderer.processNote...\n";
            if (
              window.templateRenderer &&
              window.templateRenderer.processNote
            ) {
              try {
                window.templateRenderer.processNote(text);
                output.textContent += "processNote called successfully\n";
              } catch (err) {
                output.textContent += "Error: " + err.message + "\n\n";
              }
            }
          });
      }, 2000);
    </script>
  </body>
</html>
