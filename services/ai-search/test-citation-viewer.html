<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Citation Viewer Test - AI Search Enhancements</title>
    <link rel="stylesheet" href="helpers/citation-viewer.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .header {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            margin: 0 0 0.5rem 0;
            color: #2c3e50;
        }
        .subtitle {
            color: #7f8c8d;
            margin: 0;
        }
        .test-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            margin-top: 0;
            color: #34495e;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
            margin-right: 1rem;
            margin-bottom: 0.5rem;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .test-button.success {
            background: #27ae60;
        }
        .test-button.success:hover {
            background: #229954;
        }
        .results {
            margin-top: 1rem;
            padding: 1rem;
            background: #ecf0f1;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .pass {
            color: #27ae60;
            font-weight: bold;
        }
        .info {
            color: #3498db;
        }
        code {
            background: #34495e;
            color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ§ª AI Search Enhancement - Citation Viewer Test</h1>
        <p class="subtitle">Interactive validation for modal UI component</p>
    </div>

    <div class="test-section">
        <h2>Test 1: Basic Modal Display</h2>
        <p>Click to display citation modal with sample STEMI guideline citations.</p>
        <button class="test-button" onclick="testBasicModal()">
            Show Citation Modal
        </button>
        <div id="test1-results" class="results" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Multiple Citations</h2>
        <p>Test modal with larger dataset (5 citations) to verify scrolling and layout.</p>
        <button class="test-button" onclick="testMultipleCitations()">
            Show Multiple Citations
        </button>
        <div id="test2-results" class="results" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Empty Citations</h2>
        <p>Test edge case with empty citations array.</p>
        <button class="test-button" onclick="testEmptyCitations()">
            Show Empty Citations
        </button>
        <div id="test3-results" class="results" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Keyboard Shortcuts</h2>
        <p>Open modal and press <code>Escape</code> to close.</p>
        <button class="test-button" onclick="testKeyboardShortcuts()">
            Test Escape Key
        </button>
        <div id="test4-results" class="results" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>Test 5: Click Outside to Close</h2>
        <p>Open modal and click outside (on dark overlay) to dismiss.</p>
        <button class="test-button" onclick="testClickOutside()">
            Test Click Outside
        </button>
        <div id="test5-results" class="results" style="display: none;"></div>
    </div>

    <script type="module">
        import { showCitationModal, closeCitationModal, initCitationModal } from './helpers/citation-viewer.js';
        
        // Initialize citation modal on page load
        initCitationModal();
        
        // Make functions available globally for onclick handlers
        window.showCitationModal = showCitationModal;
        window.closeCitationModal = closeCitationModal;
        
        // Test data
        const basicCitations = [
            {
                source: 'ACC/AHA 2013 STEMI Guidelines',
                evidence: 'Door-to-balloon time <90 minutes for primary PCI improves mortality outcomes.',
                url: 'https://www.ahajournals.org/doi/10.1161/CIR.0b013e3182742cf6'
            },
            {
                source: '2017 ESC STEMI Guidelines',
                evidence: 'Pre-hospital ECG and STEMI alert systems reduce treatment delays.',
                url: 'https://academic.oup.com/eurheartj/article/39/2/119/4095042'
            }
        ];
        
        const multipleCitations = [
            {
                source: 'ACC/AHA 2013 STEMI Guidelines',
                evidence: 'Primary PCI is preferred reperfusion strategy when available within 120 minutes.',
                url: 'https://www.ahajournals.org/doi/10.1161/CIR.0b013e3182742cf6'
            },
            {
                source: '2017 ESC STEMI Guidelines',
                evidence: 'Radial approach reduces bleeding complications compared to femoral access.',
                url: 'https://academic.oup.com/eurheartj/article/39/2/119/4095042'
            },
            {
                source: 'NEJM - DANAMI-2 Trial',
                evidence: 'Transfer for primary PCI superior to on-site thrombolysis.',
                url: 'https://www.nejm.org/doi/full/10.1056/NEJMoa025142'
            },
            {
                source: 'Lancet - STREAM Study',
                evidence: 'Early fibrinolysis acceptable when PCI delay >60 minutes.',
                url: 'https://www.thelancet.com/journals/lancet/article/PIIS0140-6736(12)61746-X/fulltext'
            },
            {
                source: 'Circulation - HORIZONS-AMI',
                evidence: 'Bivalirudin reduces bleeding vs. heparin plus GPIIb/IIIa inhibitors.',
                url: 'https://www.ahajournals.org/doi/10.1161/CIRCULATIONAHA.108.828541'
            }
        ];
        
        // Test functions
        window.testBasicModal = function() {
            const results = document.getElementById('test1-results');
            results.style.display = 'block';
            results.innerHTML = '<span class="info">Opening modal with 2 citations...</span>';
            
            showCitationModal(basicCitations);
            
            setTimeout(() => {
                results.innerHTML = `
                    <span class="pass">âœ“ PASS</span> - Modal opened successfully<br>
                    <span class="info">â†’</span> Displaying ${basicCitations.length} citations<br>
                    <span class="info">â†’</span> Click "Ã—" button or press Escape to close
                `;
            }, 100);
        };
        
        window.testMultipleCitations = function() {
            const results = document.getElementById('test2-results');
            results.style.display = 'block';
            results.innerHTML = '<span class="info">Opening modal with 5 citations...</span>';
            
            showCitationModal(multipleCitations);
            
            setTimeout(() => {
                results.innerHTML = `
                    <span class="pass">âœ“ PASS</span> - Modal opened with multiple citations<br>
                    <span class="info">â†’</span> Displaying ${multipleCitations.length} citations<br>
                    <span class="info">â†’</span> Verify scrolling works if needed<br>
                    <span class="info">â†’</span> Check responsive layout on mobile
                `;
            }, 100);
        };
        
        window.testEmptyCitations = function() {
            const results = document.getElementById('test3-results');
            results.style.display = 'block';
            results.innerHTML = '<span class="info">Opening modal with empty citations...</span>';
            
            showCitationModal([]);
            
            setTimeout(() => {
                results.innerHTML = `
                    <span class="pass">âœ“ PASS</span> - Modal handled empty array gracefully<br>
                    <span class="info">â†’</span> Displaying "No citations available" message
                `;
            }, 100);
        };
        
        window.testKeyboardShortcuts = function() {
            const results = document.getElementById('test4-results');
            results.style.display = 'block';
            results.innerHTML = '<span class="info">Opening modal... Press ESC to close</span>';
            
            showCitationModal(basicCitations);
            
            // Listen for modal close
            const checkClosed = setInterval(() => {
                const modal = document.getElementById('citation-modal');
                if (!modal || modal.style.display === 'none') {
                    clearInterval(checkClosed);
                    results.innerHTML = `
                        <span class="pass">âœ“ PASS</span> - Escape key closes modal<br>
                        <span class="info">â†’</span> Keyboard accessibility working
                    `;
                }
            }, 100);
            
            setTimeout(() => {
                if (results.innerHTML.includes('Press ESC')) {
                    results.innerHTML += '<br><span class="info">âš  Still open - try pressing Escape key</span>';
                }
            }, 3000);
        };
        
        window.testClickOutside = function() {
            const results = document.getElementById('test5-results');
            results.style.display = 'block';
            results.innerHTML = '<span class="info">Opening modal... Click outside (dark overlay) to close</span>';
            
            showCitationModal(basicCitations);
            
            // Listen for modal close
            const checkClosed = setInterval(() => {
                const modal = document.getElementById('citation-modal');
                if (!modal || modal.style.display === 'none') {
                    clearInterval(checkClosed);
                    results.innerHTML = `
                        <span class="pass">âœ“ PASS</span> - Click outside closes modal<br>
                        <span class="info">â†’</span> User experience intuitive
                    `;
                }
            }, 100);
            
            setTimeout(() => {
                if (results.innerHTML.includes('Click outside')) {
                    results.innerHTML += '<br><span class="info">âš  Still open - try clicking the dark overlay</span>';
                }
            }, 3000);
        };
        
        console.log('âœ“ Citation viewer test suite loaded successfully');
    </script>
</body>
</html>
